@using System.Security.Claims
@inject IUserService UserService

<nav class="navbar navbar-header navbar-expand navbar-light">
    <a class="sidebar-toggler" href="#"><span class="navbar-toggler-icon"></span></a>
    <button class="btn navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav d-flex align-items-center navbar-light ml-auto">
            <li class="dropdown nav-icon">
                <a href="#" data-toggle="dropdown" class="nav-link  dropdown-toggle nav-link-lg nav-link-user">
                    <div class="d-lg-inline-block">
                        <i data-feather="bell"></i>
                    </div>
                </a>
                <div class="dropdown-menu dropdown-menu-right dropdown-menu-large">
                    <h6 class='py-2 px-4'>Notifications</h6>
                    <ul class="list-group rounded-none">
                        <li class="list-group-item border-0 align-items-start">
                            <div class="avatar bg-success mr-3">
                                <span class="avatar-content"><i data-feather="shopping-cart"></i></span>
                            </div>
                            <div>
                                <h6 class='text-bold'>New Order</h6>
                                <p class='text-xs'>
                                    An order made by Ahmad Saugi for product Samsung Galaxy S69
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="dropdown">
                <a href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="nav-link dropdown-toggle nav-link-lg nav-link-user">

                    <div class="avatar mr-1">
                        <img src="@(Picture)" alt="" srcset="">
                    </div>

                    <div class="d-none d-md-block d-lg-inline-block">Hola, @(Name)</div>



                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                    <a class="dropdown-item" href="#"><i data-feather="user"></i> Perfil</a>
                    <a class="dropdown-item" href="#"><i data-feather="mail"></i> Messages</a>
                    <a class="dropdown-item" href="#"><i data-feather="settings"></i> Settings</a>
                    <div class="dropdown-divider"></div>
                    <NavLink class="dropdown-item" href="login"><i data-feather="log-out"></i> Cerrar Sesión</NavLink>
                </div>
            </li>
        </ul>
    </div>
</nav>

@code{
    [CascadingParameter]
    public Task<AuthenticationState> AuthenticationStateTask { get; set; }

    ClaimsPrincipal AuthenticationState { get; set; }
    string Name { get; set; }
    string Picture { get; set; }
    bool ShowProfileDropdown { get; set; }


    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateTask;
        AuthenticationState = authState.User;

        if (AuthenticationState.HasClaim(x => x.Type == ClaimTypes.Email))
        {
            var email = AuthenticationState.FindFirst(ClaimTypes.Email).Value;
            Name = AuthenticationState.FindFirst(ClaimTypes.Name).Value;
            Picture = AuthenticationState.FindFirst(ClaimTypes.Thumbprint).Value;
        }
    }

}